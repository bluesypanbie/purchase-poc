# 아키파이 매입 서비스 POC 기획

## 개요

아키파이 매입 서비스 POC 기획 문서입니다. AI 기반 실시간 시세 조회를 통해 기타/베이스 이펙터 페달의 예상 매입가를 산출하고, 사용자가 매입 신청을 진행할 수 있는 서비스입니다.

---

## 기술 스택

| 구분 | 기술 | 비고 |
|------|------|------|
| 프론트엔드 | Framer + 코드 컴포넌트 | 기존 랜딩 페이지에 추가 |
| 백엔드 | Supabase | 프로젝트명: `akify-purchase` |
| AI API | 실시간 웹 검색 기능이 있는 AI | Perplexity, Gemini 등 검토 |
| 자동화 | Make | 알림 발송, 이미지 업로드 자동화 |
| 이미지 저장소 | Google Drive | Make 경유 업로드 |
| 주소 검색 | 다음(카카오) 주소 API | |

---

## 대상 품목

- **포함**: 기타/베이스용 이펙터 페달 (꾹꾹이)
- **제외**:
  - 디지털 멀티 이펙터
  - 전문 녹음용 이펙팅 보드
  - 앰프, 기타 본체 등 기타 장비

---

## 사용자 플로우 (웹)

```
1. 매입 서비스 화면 접속
   ↓
2. 매물 정보 입력
   - 텍스트 입력란: 브랜드, 모델, 연식, 상태 등
   - 토글: 순정 박스 유무
   ↓
3. '매입가 산출하기' 버튼 선택
   ↓
4. AI가 실시간으로 시세 조회 후 예상 매입가 표시
   - "예상 매입가: ##,###원±" 형태
   - 입력 필드 잠김
   - '다시 생성하기' / '매입 신청 계속하기' 버튼 표시
   ↓
5. '매입 신청 계속하기' 버튼 선택
   ↓
6. 신청폼 작성
   ↓
7. 신청 완료
   - 신청 완료 화면에 신청번호 및 내역 요약 표시
   - (선택) 알림 발송
```

---

## 매입 관련 전체 플로우

```
웹에서 매입 신청
   ↓
담당자 확인 (이메일 알림 + Supabase 대시보드)
   ↓
판매 고객에게 배송지 안내
   ↓
판매 고객이 물품 배송
   ↓
물품 수령 및 검수
   ↓
최종 매입가 산출 및 판매 고객에게 안내
   ↓
판매 고객 동의 시 정산금 지불 / 미동의 시 반송
```

---

## 화면 구성

### 1. 초입 화면 (AI 매입가 산출)

- **텍스트 입력란**
  - 사용자 입력 내용:
    - 브랜드 및 모델 (필수)
    - 생산년도 (선택)
    - 제조국 (선택)
    - 상태 정보 (사용감, 하자 등)
  - 예시 1: "2020년식 Boss BD-2 Blues Driver 대만산 상태 양호, 사용감 다소 있음"
  - 예시 2: "아이바네즈 TS808 연식 모름, LED 고장"

- **순정 박스 유무 토글**

- **버튼**
  - 매입가 산출하기
  - 다시 생성하기 (산출 후 표시)
  - 매입 신청 계속하기 (산출 후 표시)

### 2. 신청 상세 화면

- **상단 정보** (이전 단계에서 전달)
  - AI 산출 예상 매입가
  - 사용자 입력 텍스트

- **신청폼**
  - 신청자 성함
  - 휴대전화번호
  - 반송주소
    - 주소 (다음 주소 API 연동)
    - 상세 주소
  - 정산계좌
    - 은행 (선택형)
    - 계좌번호
    - 예금주명
  - 매물 사진 (최대 10장)
  - 자유 기재란 (선택)
  - 체크박스
    - 서비스 이용약관 동의
    - 신청한 매물은 1년 이내 해외직구 상품이 아닙니다
    - (기타 동의 항목)

### 3. 신청 완료 화면

- 신청 완료 메시지
- 신청번호 표시 (예: `AF-X7K9M2`)
- 신청 내역 요약

### 4. 신청 조회 페이지

- 신청번호로 조회
- 로그인 없이 접근 가능
- URL 형태: `/purchase/status?id=신청번호`

---

## AI 매입가 산출 로직

### 시세 조회 방식
- AI가 실시간으로 웹 검색 수행
- 참고 사이트:
  - 국내: 뮬 (Mule)
  - 해외: Reverb Price Guide

### 산출 공식 (참고용)

```
매입책정가 = [(국내시세 × 국내비중) + (해외환산가 × 해외비중)] × 상태계수 × 박스계수 × 마진율
```

- **국내시세**: AI가 국내 웹사이트에서 조회한 최근 거래가
- **해외환산가**: 해외 시세 + 관세(18~20%) + 국제배송비 반영 후 60~70% 적용
- **상태계수**: AI가 사용자 입력 텍스트를 분석하여 등급(A/B/C) 자동 판정
- **박스계수**: 순정 박스 유무에 따른 가산
- **마진율**: 운영자 조정 가능

### 조정 가능한 계수 (Supabase 설정 테이블)

| 설정키 | 기본값 | 설명 |
|--------|--------|------|
| domestic_weight | 0.7 | 국내 시세 비중 |
| global_weight | 0.3 | 해외 시세 비중 |
| margin_rate | 0.7 | 마진율 |
| condition_mint | 1.0 | 신품 |
| condition_excellent | 0.9 | 매우 양호 |
| condition_good | 0.8 | 양호 |
| condition_fair | 0.7 | 보통 |
| condition_poor | 0.5 | 하자 및 고장 |
| with_box | 1.05 | 박스 있음 |
| without_box | 1.0 | 박스 없음 |

→ Supabase 대시보드에서 직접 수정 가능

---

## 알림 및 자동화

### 어드민 측
- 신청 접수 시 담당자 이메일로 알림 발송 (Make 활용)
- 신청 내용 + 이미지 URL 포함
- Supabase 대시보드에서 상세 확인

### 클라이언트 측 (검토 중)
- 옵션 1: 알림톡 (카카오 비즈니스 채널 보유)
- 옵션 2: 이메일
- 신청 조회 페이지 링크 포함 가능

---

## 기술 구현 사항

### Supabase 구성
1. **테이블**: 매입 신청 데이터 저장
2. **설정 테이블**: 계수 조정용
3. **Edge Functions**: AI API 호출 (API 키 보안)

### 이미지 업로드 구성
- **저장소**: Google Drive (Supabase Storage 용량 제한으로 대체)
- **업로드 방식**: Framer → Make Webhook → Google Drive
- **URL 저장**: 업로드된 이미지 URL을 Supabase `image_urls` 컬럼에 저장

### Framer 코드 컴포넌트
- AI 매입가 산출 컴포넌트
- 신청폼 컴포넌트 (기존 원스톱 서비스 컴포넌트 일부 재사용)
- 신청 조회 컴포넌트

### 연동
- Framer ↔ Supabase (Anon Key, Project URL)
- Supabase Edge Functions ↔ AI API
- Supabase ↔ Make (Webhook)

---

## 제약 사항

- 한 번에 한 개 매물만 신청 가능 (여러 개 시 별도 신청)
- 로그인 기능 없음 (신청번호로 조회)
- 이미지 업로드 최대 10장

---

## 개발 순서

1. Supabase 세팅 (테이블, 설정 테이블, Edge Functions)
2. AI 매입가 산출 컴포넌트 개발
3. 신청폼 컴포넌트 개발
4. 신청 조회 페이지 개발
5. Make 자동화 연동
6. Framer 통합 및 테스트

---

## 참고

- 개발 인력: 1명 (별도 진행)
- 운영/검수 인력: 별도 존재
- 기존 Framer 랜딩 페이지에 매입 서비스 페이지 추가 형태
